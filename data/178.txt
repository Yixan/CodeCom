import _pickle as cPickle
import numpy as np
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import GlobalAveragePooling1D
from keras.layers.convolutional import Convolution1D
from keras.layers.convolutional import MaxPooling1D
from keras.layers.embeddings import Embedding
from keras.layers import LSTM
from features import dumpFeatures
model.add(Embedding(max_features+1, 200, input_length=X_train.shape[1], weights=[W]))
model.add(Convolution1D(nb_filter=32, filter_length=3, border_mode='same', activation='relu'))
model.add(MaxPooling1D(pool_length=2))
model.add(Flatten())
model.add(Dense(250, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_1 = model.predict_proba(X_train, batch_size=128)
test_1 = model.predict_proba(X_test)
cPickle.dump(test_1, open('features/test/test_conv1_pretrained.dat', 'wb'))
model.add(Embedding(max_features+1, 200, input_length=X_train.shape[1], weights=[W]))
model.add(Convolution1D(nb_filter=32, filter_length=3, border_mode='same', activation='relu'))
model.add(MaxPooling1D(pool_length=2))
model.add(Flatten())
model.add(Dense(250, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_2 = model.predict_proba(X_train, batch_size=128)
test_2 = model.predict_proba(X_test)
cPickle.dump(test_2, open('features/test/test_conv2_pretrained.dat', 'wb'))
model.add(Embedding(max_features+1, 200, input_length=X_train.shape[1], weights=[W]))
model.add(Convolution1D(nb_filter=32, filter_length=3, border_mode='same', activation='relu'))
model.add(MaxPooling1D(pool_length=2))
model.add(Flatten())
model.add(Dense(250, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_3 = model.predict_proba(X_train, batch_size=128)
test_3 = model.predict_proba(X_test)
cPickle.dump(test_3, open('features/test/test_conv3_pretrained.dat', 'wb'))
model.add(Embedding(max_features+1, 200, input_length=X_train.shape[1], weights=[W]))
model.add(Convolution1D(nb_filter=32, filter_length=3, border_mode='same', activation='relu'))
model.add(MaxPooling1D(pool_length=2))
model.add(LSTM(100))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_4 = model.predict_proba(X_train, batch_size=128)
test_4 = model.predict_proba(X_test)
cPickle.dump(test_4, open('features/test/test_conv_lstm_pretrained.dat', 'wb'))
model.add(Embedding(max_features+1, 200, input_length=X_train.shape[1], weights=[W]))
model.add(LSTM(100, dropout_W=0.2, dropout_U=0.2))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_5 = model.predict_proba(X_train, batch_size=128)
test_5 = model.predict_proba(X_test)
cPickle.dump(test_5, open('features/test/test_lstm_pretrained.dat', 'wb'))
[X_train, y, X_test, max_features] = cPickle.load(open("bigram_features.dat", "rb"))
model.add(Embedding(max_features+1, 50, input_length=X_train.shape[1]))
model.add(GlobalAveragePooling1D())
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_6 = model.predict_proba(X_train, batch_size=128)
test_6 = model.predict_proba(X_test)
cPickle.dump(test_6, open('features/test/test_fasttext_bigram.dat', 'wb'))
model.add(Embedding(max_features+1, 50, input_length=X_train.shape[1]))
model.add(Convolution1D(nb_filter=32, filter_length=3, border_mode='same', activation='relu'))
model.add(MaxPooling1D(pool_length=2))
model.add(Flatten())
model.add(Dense(250, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_7 = model.predict_proba(X_train, batch_size=128)
test_7 = model.predict_proba(X_test)
cPickle.dump(test_7, open('features/test/test_conv1_bigram.dat', 'wb'))
model.add(Embedding(max_features+1, 20, input_length=X_train.shape[1]))
model.add(Convolution1D(nb_filter=32, filter_length=3, border_mode='same', activation='relu'))
model.add(MaxPooling1D(pool_length=2))
model.add(Flatten())
model.add(Dense(250, activation='relu'))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_8 = model.predict_proba(X_train, batch_size=128)
test_8 = model.predict_proba(X_test)
cPickle.dump(test_8, open('features/test/test_conv2_bigram.dat', 'wb'))
model.add(Embedding(max_features+1, 50, input_length=X_train.shape[1]))
model.add(Convolution1D(nb_filter=32, filter_length=3, border_mode='same', activation='relu'))
model.add(MaxPooling1D(pool_length=2))
model.add(LSTM(100))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_9 = model.predict_proba(X_train, batch_size=128)
test_9 = model.predict_proba(X_test)
cPickle.dump(test_9, open('features/test/test_conv_lstm_bigram.dat', 'wb'))
model.add(Embedding(max_features+1, 50, input_length=X_train.shape[1]))
model.add(LSTM(100, dropout_W=0.2, dropout_U=0.2))
model.add(Dense(1, activation='sigmoid'))
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
print(model.summary())
train_10 = model.predict_proba(X_train, batch_size=128)
test_10 = model.predict_proba(X_test)
cPickle.dump(test_10, open('features/test/test_lstm_bigram.dat', 'wb'))